<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.121.1">
  <link rel="canonical" href="https://www.tomhoule.com/2020/leaning-into-calculus-chapter-1/" />

  
    
    <meta name="description" content="This post contains three updates at different points in time on formalizing chapter 1 of Michael Spivak’s Calculus book and its problems in Lean.
You can find the proofs on GitHub.
Just starting On n’écrit qu’à la pointe de son savoir, à cette pointe extrême qui sépare notre savoir et notre ignorance, et qui fait passer l’un dans l’autre. C’est seulement de cette façon qu’on est déterminé à écrire.
(Différence et répétition, towards the beginning)">
  

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌹</text></svg>">
  <link rel="manifest" href="https://www.tomhoule.com/site.webmanifest"> 
  <link rel="mask-icon" href="https://www.tomhoule.com/safari-pinned-tab.svg" color="#000000"> 
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  

  
  
  <title>Leaning into Spivak&#39;s Calculus | Tom Houle&#39;s homepage</title>
</head>

  <body>
    <a href="#main">skip to content</a>
    <noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>

    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="https://www.tomhoule.com/"
        aria-label="Tom Houle&#39;s homepage home page"
      >
        
          <img 
            src="/images/logo.svg" 
            alt="Logo"
          >
        
      </a>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use xlink:href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      
      <a href="/blog/" aria-current="page">
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Blog</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>

    
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use xlink:href="#bookmark"></use>
      </svg>
      Leaning into Spivak&#39;s Calculus
    </h1>

    <div class="date">
      
      
      <strong>Publish date: </strong>2020-11-14
      
        
      
    </div>

    
      <div class="tags">
        <strong>Tags: </strong>
        <ul aria-label="tags">
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/maths/">maths</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/spivak-calculus/">spivak-calculus</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/lean/">lean</a>
            </li>
          
        </ul>
      </div>
    

    


    <p>This post contains three updates at different points in time on formalizing
chapter 1 of Michael Spivak&rsquo;s <em>Calculus</em> book and its problems in <a href="https://leanprover-community.github.io/">Lean</a>.</p>
<p>You can find the proofs <a href="https://github.com/tomhoule/spivak-calculus/">on GitHub</a>.</p>
<hr>
<h2 id="just-starting">Just starting</h2>
<blockquote>
<p>On n’écrit qu’à la pointe de son savoir, à cette pointe extrême qui sépare
notre savoir et notre ignorance, et qui fait passer l’un dans l’autre. C’est
seulement de cette façon qu’on est déterminé à écrire.</p>
<p>(<a href="https://en.wikipedia.org/wiki/Difference_and_Repetition"><em>Différence et
répétition</em></a>, towards
the beginning)</p>
</blockquote>
<p>They say the right time to write about something is while learning. I just got
through <a href="https://leanprover.github.io/theorem_proving_in_lean/"><em>Theorem proving in
Lean</em></a> — tons of fun,
warmly recommended — and now feels like the time to see what I can do with it.</p>
<p>I have Michael Spivak&rsquo;s
<a href="https://www.goodreads.com/book/show/328645.Calculus"><em>Calculus</em></a>, third
edition, lying around at home. It should be accessible with a bit of help from
the internet, so this is what I will attempt to go through. I expect nearly all
of the book&rsquo;s content to be new to me.</p>
<p>What I want to validate is that for someone reasonably familiar with programming
who wants to learn more mathematics, it is possible to learn by writing proofs
and solving problems from regular maths textbooks with existing tools, and in
particular the Lean theorem prover. <strong>The hard part should be the mathematics,
not handling the theorem prover</strong>.</p>
<p>I have the feeling this would be the best way for me to learn, since I lack the
confidence in my hand-written proofs, and I know by experience that I make a lot
of mistakes. On paper, these mistakes end up derailing the proof, but they
wouldn&rsquo;t have serious consequences if every step was checked by a computer: I
can just correct them.</p>
<p>I will frequently refer to
<a href="https://github.com/leanprover-community/mathlib">mathlib</a>, the Lean community&rsquo;s
library of formalized theorems. It contains basic facts and structures you do
not want to build again when writing your own proofs, as well as extremely
useful tactics like <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#linarith"><code>linarith</code></a>.</p>
<h3 id="first-chapter">First chapter</h3>
<p>The first chapter is titled <em>Basic properties of numbers</em>. Its purpose is to
reformulate and condense facts that the reader supposedly already knows.</p>
<p>Twelve properties are treated. Four properties of addition:</p>
<ol>
<li>Associativity: <em>a</em> + (<em>b</em> + <em>c</em>) = (<em>a</em> + <em>b</em>) + <em>c</em></li>
<li>Zero as the identity element: <em>a</em> + 0 = 0 + <em>a</em> = <em>a</em></li>
<li>Addition of opposites: <em>a</em> + (-<em>a</em>) = (-<em>a</em>) + <em>a</em> = 0</li>
<li>Commutativity: <em>a</em> + <em>b</em> = <em>b</em> + <em>a</em></li>
</ol>
<p>By now, subtraction is already defined, and two small proofs already carried
out. I used the standard library&rsquo;s <code>int</code> module for the time being, but
I suspect we&rsquo;ll have to switch to mathlib&rsquo;s real number module or something
else, after I read a bit more about it.</p>
<p>The next properties are about multiplication:</p>
<ol start="5">
<li>Associativity: <em>a</em> · (<em>b</em> · <em>c</em>) = (<em>a</em> · <em>b</em>) · <em>c</em></li>
<li>One as the identity element: <em>a</em> · 1 = 1 · <em>a</em> = <em>a</em></li>
<li>Multiplication of inverses:
∀ <em>a</em>, <em>a</em> ≠ 0 → ∃ <em>a⁻¹</em>, <em>a</em> · <em>a⁻¹</em> = <em>a⁻¹</em> · <em>a</em> = 1</li>
<li>Commutativity: <em>a</em> · <em>b</em> = <em>b</em> · <em>a</em></li>
</ol>
<p>Division is then defined in terms of multiplication. The part of property 7
about <em>a</em> ≠ 0 explains why division by zero doesn&rsquo;t work (it has no meaningful
inverse).</p>
<p>At this point, I feel an itch to generalize this beyond integers. We&rsquo;re going to
need at least real numbers, I figure. I start browsing Wikipedia:
<a href="https://en.wikipedia.org/wiki/Group_(mathematics)">groups</a> aren&rsquo;t what we want
(numbers under addition are a group, but not multiplication because it lacks
invertibility). Next stop is
<a href="https://en.wikipedia.org/wiki/Multiplication#Multiplication_of_different_kinds_of_numbers">multiplication</a>,
which points me to the page on the <a href="https://en.wikipedia.org/wiki/Construction_of_the_real_numbers#Construction_from_Cauchy_sequences">construction of real
numbers</a>,
where I learn about <a href="https://en.wikipedia.org/wiki/Field_(mathematics)">ordered
fields</a>. This is apparently
what we want, and mathlib <a href="https://leanprover-community.github.io/mathlib-overview.html">apparently supports
them</a>.</p>
<p>I hope this attitude of digging just as deep as I need to in order to make
progress is going to work out.</p>
<p>After a little while digging into how to import mathlib (combination of using
the right lean version in <code>leanpkg.toml</code>, learning the existence of <code>import</code>
statements, and the right <code>leanpkg</code> invocations — <em>Note added later: use
<code>leanproject</code> instead if you want to avoid compiling mathlib, it is very
time-consuming</em>), I realize working with fields won&rsquo;t let you use convenient
numeric notations. I try real numbers — appropriately located at
<code>data.real.basic</code> in mathlib — only to realize that reflexivity doesn&rsquo;t work for
things as simple as <code>5 - 3 = 2</code>. Looking at the source for the <code>data.real.basic</code>
module, it seems like many definitions are non-computable. It makes sense,
because real numbers aren&rsquo;t the floats we know and love, π isn&rsquo;t some
approximation but really π, and we can&rsquo;t compute that exactly. I don&rsquo;t know whether Lean
can &ldquo;specialize&rdquo; computable instances automatically, and detect that even though
<code>5</code> and <code>3</code> are real numbers in this context, <code>5 - 3</code> is computable. I&rsquo;d have to
know more about representations of reals to know if it&rsquo;s a temporary limitation
in mathlib or something deeper. So I go with rational numbers for the examples
involving reflexivity. <code>α</code> is a field, rational numbers are a field, so it works
out nicely.</p>
<p>The consequences of the properties of multiplication give rise to two nice
examples we can prove in Lean:</p>
<pre><code class="language-lean">example : (a ≠ 0) → (a * b = a * c) → b = c :=
assume hnzero h,
    calc
        b   = 1 * b : by rw one_mul
        ... = (a⁻¹ * a) * b : by rw [inverse_mul α a hnzero]
        ... = a⁻¹ * (a * b) : by rw [mul_assoc']
        ... = a⁻¹ * (a * c) : by rw [h]
        ... = c : by rw [mul_assoc', inverse_mul α a hnzero, one_mul]

example : a ≠ 0 → (a * b = 0) → (a = 0 ∨ b = 0) :=
assume hnzero h,
or.inr $ calc
    b = 1 * b : by rw one_mul b
    ... = (a⁻¹ * a) * b : by rw [inverse_mul α a hnzero]
    ... = a⁻¹ * (a * b) : by rw [mul_assoc']
    ... = a⁻¹ * 0 : by rw h
    ... = 0 : by rw mul_zero
</code></pre>
<p>I started by adding <code>decidable α</code> instance on top of <code>field α</code> to get
<code>a = 0 ∨ ¬(a = 0)</code> for the second example. It felt like it should be possible to
prove it without, but it seemed like even mathlib uses <code>classical</code> (see
<code>mul_eq_zero'</code> in <code>group_with_zero.lean</code>, and <code>division_ring.to_domain</code> in
<code>field.lean</code>). Then I noticed the book relies on <code>a ≠ 0</code> and added the hypothesis.</p>
<ol start="9">
<li>Distributivity: <em>a</em> · (<em>b</em> + <em>c</em>) = (<em>a</em> · <em>b</em>) + (<em>a</em> · <em>c</em>)</li>
</ol>
<p>For the next proof, I needed a proof of <code>0 ≠ 2</code>, which I got to from <code>0 &lt; 2</code>,
which required changing the instance of <code>field α</code> to <code>linear_ordered_field α</code>.
That seems reasonable.</p>
<p>Writing down the proof also made it clearer that the part that needs
distributivity is <code>a + a = 2 * a</code>:</p>
<pre><code class="language-lean">def add_self_eq_two_mul : a + a = 2 * a :=
calc
    a + a   = (a * 1) + a : by rw mul_one'
        ... = (a * 1) + (a * 1) : by rw mul_one'
        ... = a * (1 + 1) : by rw [←mul_distrib']
        ... = a * 2 : by refl
        ... = 2 * a : by rw mul_comm'
</code></pre>
<p><code>-a</code> can also be called an additive inverse. Interesting.</p>
<p>&hellip;<em>ellipsis</em>&hellip;</p>
<hr>
<h2 id="two-weeks-later">Two weeks later</h2>
<p>I continued going through the chapter step by step, and now getting started on
the problems.</p>
<ul>
<li>Some patterns like &ldquo;divide both sides of the equation by the same amount&rdquo; do
not translate easily to Lean. I had to learn to &ldquo;summon&rdquo; values, adding zero,
then opposite, or multiplying by one, then inverse.</li>
<li>Represent sequences with inductively defined functions (gizmo).</li>
<li>A lot of function names to memorize</li>
<li>I somehow find some facts easier to grasp through induction rules:
<ul>
<li><code>choose k n = choose k-1 n-1 + choose k n-1</code></li>
<li><code>n! = n * (n-1)!</code></li>
</ul>
</li>
<li>I had to figure out big operators and how to use finite sets (<code>finset</code>)</li>
<li>For problem 4, I had to figure out casts and
<code>rwa</code>, <code>simpa</code>. Do the computable parts with integers, then cast to reals to
work with square roots. Computations with real numbers were a pain at first,
since they are not computable: you need to cast to something computable, like
rational numbers, to make any progress. <em>Note added later: this was all solved when I learned
about the <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#norm_num"><code>norm_num</code></a> and <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#norm_cast"><code>norm_cast</code></a> tactics</em>.</li>
<li><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#library_search">library_search</a>,
<a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#squeeze_simp%20/%20squeeze_simpa%20/%20squeeze_dsimp%20/%20squeeze_scope">squeeze_simp</a>
are big time-savers and enormously helpful in discovering more of mathlib. One
pattern that works really well when you are looking for the right theorems to
invoke for the next step in your proof, is to write it in the most general way
possible in an example or a helper function, and try <code>library_search</code> on that.</li>
<li>Try <code>#lint</code> — it&rsquo;s quaint.</li>
</ul>
<p>I&rsquo;ll stop here now, and focus on solving the problems without worrying about
whether this will make a good blog post.</p>
<hr>
<h2 id="a-few-months-later">A few months later</h2>
<p>Let&rsquo;s follow up on the experience report, where I wrote down my impressions as I
just started working on the problems from Michael Spivak&rsquo;s
<a href="https://www.goodreads.com/book/show/328645.Calculus"><em>Calculus</em></a> (3rd ed.) with
the Lean theorem prover.</p>
<p>A few months later, <a href="https://github.com/tomhoule/spivak-calculus/">I finished writing Lean proofs for all the problems in chapter 1</a>.</p>
<p>After the expected period of familiarization with Lean and
mathlib, what I hoped for is what happened: <strong>at this point, for the problems I
am solving, the hard part is the maths, not the theorem prover</strong>.</p>
<h3 id="writing-down-the-problems">Writing down the problems</h3>
<p>Some problems took some thinking to translate from natural language into Lean.
Stating the problem precisely is part of the proof effort.</p>
<p>Take problem 24 (c):</p>
<blockquote>
<p>Let <code>s(a_{1},...,a_{k})</code> be some sum formed from <code>a_{1},...,a_{k}</code>. Show that
s(a_1,&hellip;,a_k) = a_1 + &hellip; + a_k</p>
</blockquote>
<p>The &ldquo;some sum&rdquo; part is open to interpretation. It could mean different ordering
of the terms, or different precedence. I went with precedence, and wrote the
following proof:</p>
<pre><code class="language-lean">-- For any list of lists of sums, show that the sum of the list_sum's is equal
-- to the list_sum of the concatenated lists. This shows the order of
-- additions does not matter.
def part_c : ∀ (sums : list (list ℝ)), list_sum (list.join sums) = sums.foldl running_list_sum 0
| [] := rfl
| (head::tail) := by {
    let consed := list.cons head tail,
    have ih : list_sum (list.join tail) = tail.foldl running_list_sum 0, from part_c tail,
    have left : list_sum (list.join consed) = list_sum head + list_sum (list.join tail), from (
        calc
        list_sum (list.join (head::tail)) = list_sum (head ++ list.join tail) : rfl
        ... = list_sum head + list_sum (list.join tail) : (part_b head (list.join tail)).symm
    ),
    have right : consed.foldl running_list_sum 0 = list_sum head + tail.foldl running_list_sum 0, from (
      calc
      consed.foldl running_list_sum 0 = tail.foldl running_list_sum (0 + list_sum head) : rfl
      ... = tail.foldl running_list_sum (list_sum head) : by rw [zero_add]
      ... = list_sum head + tail.foldl running_list_sum 0 : foldl_running_list_assoc tail (list_sum head)
    ),
    rw [&lt;-ih] at right,
    exact eq.trans left (eq.symm right)
}
</code></pre>
<p>Helper functions have been omitted. See the source repository for the full proof.</p>
<p>One of the tougher examples came up towards the beginning, in part (v) of problem 1:</p>
<blockquote>
<p>(v) x^n - y^n = (x - y) (x^{n-1} + x^{n-2}y + … + xy^{n-2} + y^{n-1})</p>
</blockquote>
<p>This required figuring things out about <code>choose</code> that belong in chapter 2, how
to express sums with a variable number of terms — the <code>algebra.big_operators</code>
module in mathlib —, and also how to use a recursive dependently typed function to
express the middle terms.</p>
<p>Another example of this were problems of the form <em>&ldquo;Find all numbers x for
which&rdquo;</em>, like problem 11. I did not realize at first that what was really meant,
was proofs of the form <code>abs (x+3) &lt; 2 ↔ x &lt; -1 ∧ x &gt; -5</code>.</p>
<h3 id="general-advice">General advice</h3>
<ul>
<li>The <a href="https://leanprover.zulipchat.com/">Lean community Zulip chat server</a> is
extremely valuable.
<ul>
<li>For discovering new approaches by much more experienced users.</li>
<li>To read the experienced user&rsquo;s advice to other new users.</li>
<li>For more high-level discussions, for example how the Lean community put an
emphasis on working in the same classical framework as most maths
practitioners, instead of computable proofs like Coq.</li>
<li>&hellip;</li>
</ul>
</li>
<li>Getting familiar with the structure of mathlib and the available modules is
important. Don&rsquo;t be afraid to read the source. Exploring tactics you don&rsquo;t
know always pays off. I stumbled on tactics that improve ergonomics a lot like
<code>rcases</code>, <code>rintros</code> and <code>refine</code> quite late.</li>
<li>Use concrete types if you do not care about generality. I solved the problems
for fields at the beginning, but after discovering <code>norm_num</code>, proving with ℝ
parameters turned out easier.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>As already stated above, there was a learning curve, but at this point, the
hard part is the mathematics and coming up with the right proof strategies, not
formalizing them in Lean. There is a price in terms of productivity and
effort to these machine-checked proofs, and I am sure someone confident with
pen-and-paper proofs can go through the problems much faster, and use patterns
that would not work in a theorem prover, like visual proofs. But for me, this is
the right workflow.</p>
<p>I will continue using Lean to learn more mathematics, it is really a joy. Now on
to chapter 2.</p>

  </main>

          
            <footer role="contentinfo">
  
    🌹 caute
  
</footer>

          
        </div>
      </div>
    </div>
    

<script src="/js/dom-scripts.js"></script>  



  </body>
</html>
